<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Pirate's Folly | SLC is</title><meta name=description content="Sharpest corner of the IPFS."><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/music/>Music</a></li><li><a href=/about/>About</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Pirate&rsquo;s Folly</span></h1><h2 class=date>2022/01/11</h2></div><main><p>The Raspberry Pi Pico inspired the release of the <a href=https://shop.pimoroni.com/products/picosystem>Picosystem</a>. I love working with limited hardware as a challenge to improve my programming. I&rsquo;ve had my fair share of <a href="https://www.romhacking.net/forum/index.php?topic=31892.0">6502 assembly</a> for the <abbr title="Nintendo Entertainment System">NES</abbr> but recently enjoyed the new RP2040. The Picosystem uses the RP2040 to run games, so I just had to try it out!</p><p>I began development of Pirate&rsquo;s Folly, a procedurally generated game. I&rsquo;ve laid the groundwork for terrain and item generation; however, enemy placement is still needed. <em>In the <a href=https://github.com/splch/pirates-folly>GitHub repo</a>, I have a list of completed and planned features.</em> The idea is a blend between One Piece, Minecraft, and No Man&rsquo;s Sky. Pirates competing for treasure is such an entertaining concept since pirates are the most unpredictable and greedy people! To lean on my CS (and not artistic) background, I used <a href=http://freespace.virgin.net/hugo.elias/models/m_perlin.htm>Hugo Elias&rsquo;</a> procedural generation webpage for algorithm details. His site is down, so you can view a <a href=/data/perlinNoise.pdf>locally-served PDF</a>. That enabled me to generate over a thousand square kilometers of terrain to explore. So, like Minecraft there is a vast world to explore, but I have a global seed (57) that will show the same world to everyone. In that way, players can share good locations for items or pirates.</p><p><img src=/images/piratesFolly2.webp alt=PicoSystem></p><p>I&rsquo;ll keep this page updated as I proceed. Currently, I&rsquo;m wondering if I want to develop the game for Game Boy with the upcoming release of the <a href=https://www.analogue.co/pocket>Analogue Pocket</a> and <a href=https://www.gbstudio.dev/><abbr title="Game Boy">GB</abbr> Studio 3.0</a>.</p><h1 id=transition-to-game-boy>Transition to Game Boy</h1><iframe class=gameboy allow=gamepad src=https://js-emulator.splch.repl.co/></iframe><p>Sadly, the Picosystem <abbr title="Software Development Kit
">SDK</abbr> stopped getting <a href=https://github.com/pimoroni/picosystem/commit/266c7d992b52f6b6af1c5c77f350bf010047ce0e>updates</a> after the system release, so I decided to move the game to a more reliable console. Restraining the requirements further, I began using <a href=https://github.com/gbdk-2020/gbdk-2020>GBDK-2020</a> to make a GB game!</p><p>I chose to use GBDK-2020 instead of GB Studio because I know how to program C and something like procedural-generation isn&rsquo;t nearly as common as side-scrolling games. When GB Studio abstracts away a lot of the programming aspects, they lower the barrier of entry while compromising expressability.</p><p>A lot of the code from the Picosystem could be reused for Game Boy; however, every 16-bit variable needed to be converted to 8-bit. In addition, float arithmetic isn&rsquo;t supported in GBDK (or on the GB&rsquo;s Z80 processor for that matter). These restrictions ultimately reduced the quality of map generation, but it should still be good enough for exploration.</p><p><img src=/images/piratesFolly1.webp alt="Game Boy"></p><h2 id=procedural-generation>Procedural Generation</h2><p>After loads of trial and error, I found that the following formula works very well to provide fast and seeded noise.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>uint8_t</span> <span style=color:#a6e22e>noise</span>(<span style=color:#66d9ef>uint8_t</span> x, <span style=color:#66d9ef>uint8_t</span> y) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// return random number [49, 201]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// derived from perlin noise and 8-bit xorshift
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  x <span style=color:#f92672>^=</span> (y <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>7</span>);
</span></span><span style=display:flex><span>  x <span style=color:#f92672>^=</span> (x <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>  y <span style=color:#f92672>^=</span> (x <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>  y <span style=color:#f92672>^=</span> (y <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> x <span style=color:#f92672>^</span> y <span style=color:#f92672>*</span> SEED;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The formula took inspiration from Hugo Elias&rsquo; tutorial, but is closer to <a href=https://bumbershootsoft.wordpress.com/2017/03/11/getting-a-decent-and-fast-prng-out-of-an-8-bit-chip/>Michael Martin&rsquo;s xorshift post</a>. The xorshifts I use differ from common xorshift algorithms in that the function doesn&rsquo;t use its previous output as the next input. Here, <code>noise</code> is a function of <code>x</code>, <code>y</code>, and <code>SEED</code>.</p><h2 id=profiling>Profiling</h2><table><thead><tr><th>Procedure</th><th style=text-align:center>% Self Cycles</th><th>Self Cycles</th><th>Invocations</th><th>Procedure Cycles</th></tr></thead><tbody><tr><td>_interpolate_noise</td><td style=text-align:center>40.7%</td><td>100035660</td><td>12786</td><td>6036/8112/8111.8</td></tr><tr><td>_set_bkg_tiles.set_xy_btt</td><td style=text-align:center>21.6%</td><td>53069008</td><td>6732</td><td>4520/8328/7883.1</td></tr><tr><td>_shift_array_left</td><td style=text-align:center>16.8%</td><td>41287680</td><td>6718</td><td>122880/122880/122880.0</td></tr><tr><td>_shift_array_up</td><td style=text-align:center>9.3%</td><td>22786176</td><td>336</td><td>67816/67816/67816.0</td></tr><tr><td>_generate_side</td><td style=text-align:center>3.8%</td><td>9259312</td><td>673</td><td>167776/189308/180029.8</td></tr><tr><td>_terrain</td><td style=text-align:center>2.0%</td><td>4909548</td><td>12786</td><td>6188/8540/8539.8</td></tr><tr><td>_noise</td><td style=text-align:center>1.5%</td><td>3784584</td><td>473073</td><td>8/8/8.0</td></tr><tr><td>_generate_item</td><td style=text-align:center>1.1%</td><td>2608344</td><td>12786</td><td>212/212/212.0</td></tr><tr><td><em>LABEL_1C6</em></td><td style=text-align:center>1.0%</td><td>2394684</td><td>3501</td><td>684/684/684.0</td></tr><tr><td>_display_map</td><td style=text-align:center>0.6%</td><td>1595432</td><td>6732</td><td>155176/158632/157505.6</td></tr><tr><td><em>LABEL_40</em></td><td style=text-align:center>0.4%</td><td>1100820</td><td>3501</td><td>1100/1112/1100.0</td></tr><tr><td>_set_bkg_tiles</td><td style=text-align:center>0.4%</td><td>1077088</td><td>6732</td><td>4680/8488/8043.1</td></tr><tr><td>_closest</td><td style=text-align:center>0.2%</td><td>562584</td><td>12786</td><td>44/44/44.0</td></tr><tr><td>_update_position</td><td style=text-align:center>0.1%</td><td>298604</td><td>2212735</td><td></td></tr><tr><td><em>LABEL_A4</em></td><td style=text-align:center>0.1%</td><td>210060</td><td>3501</td><td>744/744/744.0</td></tr><tr><td>_generate_map_sides</td><td style=text-align:center>0.1%</td><td>182872</td><td>6719</td><td>167864/551336/550198.1</td></tr><tr><td><em>LABEL_0</em>.call_hl</td><td style=text-align:center>0.1%</td><td>126204</td><td>3501</td><td>780/792/780.0</td></tr><tr><td>_get_terrain</td><td style=text-align:center>0.0%</td><td>117068</td><td>1009</td><td>68/140/116.0</td></tr><tr><td>00106$</td><td style=text-align:center>0.0%</td><td>110232</td><td>2206353</td><td></td></tr><tr><td>_check_interactions</td><td style=text-align:center>0.0%</td><td>75264</td><td>336</td><td>264/264/264.0</td></tr><tr><td>_joypad</td><td style=text-align:center>0.0%</td><td>67200</td><td>336</td><td>200/200/200.0</td></tr><tr><td>_adjust_position</td><td style=text-align:center>0.0%</td><td>36396</td><td>337</td><td></td></tr><tr><td><em>LABEL_48</em>.int</td><td style=text-align:center>0.0%</td><td>19500</td><td>75</td><td>1040/1052/1040.2</td></tr><tr><td>_clock</td><td style=text-align:center>0.0%</td><td>13440</td><td>336</td><td>40/40/40.0</td></tr><tr><td>_main</td><td style=text-align:center>0.0%</td><td>0</td><td>12778</td><td></td></tr><tr><td>_check_input</td><td style=text-align:center>0.0%</td><td>0</td><td>12778</td><td></td></tr></tbody></table></main><footer></footer></body></html>