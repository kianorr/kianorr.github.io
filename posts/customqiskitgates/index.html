<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Custom Gates in Qiskit with Pulse | SLC is</title><meta name=description content="Sharpest corner of the IPFS."><meta name=keywords content="Qiskit"><link rel=stylesheet href=../../css/simple.css/simple.min.css media=all onload='this.media="all",this.onload=null'></head><body><header><nav><a href=../../>Home</a>
<a href=../../posts/>Posts</a>
<a href=../../music/>Music</a>
<a href=../../about/>About</a></nav><h1>Custom Gates in Qiskit with Pulse</h1><i>December 7, 2021</i></header><main><mark>4 minutes</mark><aside><details open><summary>Table of Contents</summary><ul><li><a href=#imports>Imports</a><ul><li><a href=#create-a-custom-gate>Create a custom gate</a></li><li><a href=#build-pulse-for-custom-gate>Build pulse for custom gate</a></li><li><a href=#use-custom-gate>Use custom gate</a></li></ul></li><li><a href=#convert-the-circuit-back-to-a-pulse>Convert the circuit back to a pulse</a></li><li><a href=#execute-circuit>Execute Circuit</a><ul><li><a href=#version-information>Version Information</a></li></ul></li></ul></details></aside><p>Quantum research often requires applying operations in novel ways; however, it&rsquo;s occasionally necessary to create gates to reduce circuit length. If too many operations are applied to a qubit, the quantum state is lost and no valuable insight can be gained. The quantum compiler can optimize these steps, but having the ability to create custom microwave pulses to apply to qubits is valuable.</p><p>In this quick tutorial, we will compose a Hadamard pulse and apply it to a qubit through a circuit using Qiskit. That&rsquo;s quite a mouthful, but it&rsquo;s a lot nicer than it seems.</p><h2 id=imports>Imports</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Aer</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>assemble</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pulse</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>QuantumCircuit</span><span style=color:#000;font-weight:700>,</span>\
</span></span><span style=display:flex><span>                   <span style=color:#000>schedule</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>transpile</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.circuit</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Gate</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.providers.aer</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PulseSimulator</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.providers.aer.pulse</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PulseSystemModel</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.test</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>mock</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.pulse.library</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Gaussian</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.visualization</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>plot_histogram</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>qiskit.visualization.pulse_v2</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>draw</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>qiskit.tools.jupyter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># fake quantum computer we&#39;re using</span>
</span></span><span style=display:flex><span><span style=color:#000>backend</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>FakeArmonk</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>We need to import the necessary Qiskit modules, but one thing to note is the mock backend we&rsquo;re using. From <code>qiskit.test</code> we import <code>mock</code> and use its fake Armonk backend. This is a fake quantum computer that will simulate our code. Armonk also supports Qiskit Pulse and pulse simulations which we need. Waiting to run pulses on hardware can take a long time, so having a simulator is extremely helpful when prototyping quantum gates.</p><p>To begin our custom gate, we need to define a non-calibrated gate that we will later calibrate with a custom microwave pulse.</p><h3 id=create-a-custom-gate>Create a custom gate</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>gate</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Gate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;hadamard&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>label</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;H&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>num_qubits</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[])</span>
</span></span></code></pre></div><p>We created a gate that will apply a pulse to one qubit. But the gate doesn&rsquo;t have a pulse yet. Let&rsquo;s fix that!</p><h3 id=build-pulse-for-custom-gate>Build pulse for custom gate</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create a microwave pulse with a gaussian curve</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>with</span> <span style=color:#000>pulse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>build</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>backend</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;hadamard&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>gate_pulse</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># custom pulse for this demo</span>
</span></span><span style=display:flex><span>    <span style=color:#000>microwave</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Gaussian</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>duration</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>310</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>amp</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>.36</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sigma</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pulse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>play</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>microwave</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pulse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>drive_channel</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>gate_pulse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>draw</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p><img src=../../images/pulseVisual1.webp alt="Hadamard Gaussian"></p><p>Most waves can be parameterized by a gaussian shape in quantum computing. In Qiskit Pulse, we simply define the shape of the curve and set that microwave to a variable <code>gate_pulse</code>. This pulse can be changed in both shape and parameters. Qiskit also offers non-gaussian curves that can be used, though gaussian is most commonly seen.</p><p>The next step is to attach this microwave pulse to the custom gate we initialized.</p><h3 id=use-custom-gate>Use custom gate</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>qc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>QuantumCircuit</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># append the custom gate</span>
</span></span><span style=display:flex><span><span style=color:#000>qc</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span><span style=color:#000>qc</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>measure</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># define pulse of quantum gate</span>
</span></span><span style=display:flex><span><span style=color:#000>qc</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_calibration</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;hadamard&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>gate_pulse</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>qc</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>draw</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;mpl&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>We can treat the gate normally when building circuits, but adding the pulse is different. Qiskit uses <code>add_calibration</code> to apply a custom pulse to a specific gate.</p><p><img src=../../images/pulseVisual2.webp alt="Gate Circuit"></p><p>We&rsquo;re now using a custom gate in a circuit, but let&rsquo;s confirm that this circuit is <em>actually</em> applying the pulse we specified.</p><p>We can use Qiskit Pulse to transpile the circuit to pulses that would be directly run on the quantum computers.</p><h2 id=convert-the-circuit-back-to-a-pulse>Convert the circuit back to a pulse</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># unnecessary with calibrated gates</span>
</span></span><span style=display:flex><span><span style=color:#000>qc_t</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>transpile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>qc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>backend</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>qc_pulse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>schedule</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>qc_t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>backend</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>draw</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>qc_pulse</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>backend</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>backend</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><img src=../../images/pulseVisual3.webp alt="Circuit Pulses"></p><p>If you compare the microwave we defined above to this, you can see that it is indeed the same. Our circuit is now using a custom Hadamard gate! But let&rsquo;s not be too quick to celebrate.</p><p>Let&rsquo;s run one final test to see how the simulator handles custom pulses.</p><h2 id=execute-circuit>Execute Circuit</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create a pulse simulator and model</span>
</span></span><span style=display:flex><span><span style=color:#000>backend_sim</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PulseSimulator</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>system_model</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>PulseSystemModel</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>from_backend</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>backend</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># prepare the pulse job</span>
</span></span><span style=display:flex><span><span style=color:#000>pulse_qobj</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>assemble</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>qc_pulse</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>backend</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>backend_sim</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># run the job on the backend</span>
</span></span><span style=display:flex><span><span style=color:#000>sim_result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>backend_sim</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pulse_qobj</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>This method of simulating circuits is different from most tutorials you&rsquo;ll find. Since we&rsquo;re using a custom pulse, our simulator needs to be able to handle that. We use the <code>PulseSimulator</code> to handle this kind of circuit. I believe it&rsquo;s due to the normal simulator using matrices while this needs to handle microwaves, but I&rsquo;m not sure.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># plot circuit output</span>
</span></span><span style=display:flex><span><span style=color:#000>plot_histogram</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sim_result</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_counts</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></div><p><img src=../../images/pulseVisual4.webp alt="Measurement Histogram"></p><p>Success! As expected, the qubit is in a superposition between $\ket{0}$ and $\ket{1}$. The near 50-50 distribution supports that… but what happens when you apply two of these pulses in succession? We&rsquo;ll tackle that at a later time, but if you want a head-start, check out the <a href=https://qiskit.org/textbook/ch-quantum-hardware/calibrating-qubits-pulse.html>Rabi experiment</a>. 😵‍💫</p><h3 id=version-information>Version Information</h3><table><thead><tr><th>Qiskit Software</th><th style=text-align:right>Version</th></tr></thead><tbody><tr><td>qiskit-terra</td><td style=text-align:right>0.19.1</td></tr><tr><td>qiskit-aer</td><td style=text-align:right>0.9.1</td></tr><tr><td>qiskit-ignis</td><td style=text-align:right>0.7.0</td></tr><tr><td>qiskit-ibmq-provider</td><td style=text-align:right>0.18.2</td></tr><tr><td>qiskit</td><td style=text-align:right>0.33.1</td></tr></tbody></table><aside><hr><details open><summary>Related Content</summary><ul><li><a href=../../posts/comparerngs/>Quantum versus Avalanche Breakdown Randomness</a></li><li><a href=../../posts/quantumtales/>Quantum Tales</a></li><li><a href=../../posts/quantumphysics/>Quantum Physics I</a></li><li><a href=../../posts/quantumsummer/>Summer of Quantum</a></li></ul></details></aside></main><footer><small>Thanks to a <a href=https://gohugo.io/>gopher</a> for building and the <a href=https://ipfs.io/>galaxy</a>
for hosting ♡</small><i></i></footer></body></html>